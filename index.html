<!---AS.03--->

<!DOCTYPE html>
<html>
	<head>

		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
		
		<link rel="stylesheet" type="text/css" href="css/index.css">
		
		<title>Land Grant Goods Honey Jar Access</title>

	</head>
	
	<body>
		<!--- Nav bar additional handles the padding around the nav bar --->
		<div class="parallax-window nav-bar-additional" data-parallax="scroll" data-image-src="images/greenhousesDark.jpg">

				<nav class="navbar navbar-dark navbar-expand-lg navbar-transparent">
				 	<a class="navbar-brand" href="#">
				 		<!--- proper ratio for logo is 757 width 1005 height no unit. Nav bar logo --->
				   		<img href="index.html" src="images/logo.png" class="lgg-logo">
				 	</a>

				 	<!--- This button appears when the page goes to mobile or mid-tablet sizes. Condenses navbar. --->
					<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
    				<span class="navbar-toggler-icon"></span>
  					</button>

					<div class="collapse navbar-collapse justify-content-end" id="navbarNavAltMarkup">
					<div class="navbar-nav">
						<!--- This  handles the links on the nav bar --->
					  <a class="nav-item nav-link active outlined-text" href="index.html">Home<span class="sr-only">(current)</span></a>
					  <a class="nav-item nav-link active outlined-text" href="blockchain101.html">Blockchain 101</a>
					  <a class="nav-item nav-link active outlined-text" href="http://localhost:4200/" target="_blank">Launch Web App (Beta)</a>
						<div id="header_button"> <button onclick="location.href='https://www.landgrantgoods.com/'" type="button" class="btn btn-light">Store (Off-Site)</button> </div>
						<!--- Need a transparent white icon: <a href="#"><img class="icon-format" src="images/mail_icon.png"></a> --->
					    
					    <a href="https://twitter.com/landgrantgoods" class="d-none d-lg-block d-xl-none d-none d-xl-block"><img class="icon-format"  src="images/twitter_icon_resize.png"></a>
					    <a href="https://www.instagram.com/landgrantgoods/" class="d-none d-lg-block d-xl-none d-none d-xl-block"><img class="icon-format" src="images/ig_logo.png"></a>
					    <a href="https://www.facebook.com/landgrantgoods/" class="d-none d-lg-block d-xl-none d-none d-xl-block"><img class="icon-format" src="images/facebook_logo.png"></a>

					</div>
			<!--- This  div is for <div class="collapse navbar-collapse justify-content-end" id="navbarNavAltMarkup">, and the div above is for the div above that --->
					</div>
				</nav>

			<div class="container-fluid">
				<div class="row justify-content-center" style="padding-top: 3.5rem;">
					<div class="col-lg-5 col-md-3"> </div>
					<div class="col-lg-2 col-md-6 white-font outlined-text" style="text-align: center"><h1 class="parallax-title">HONEY</h1></div>
					<div class="col-lg-5 col-md-3"> </div>
				</div>
			</div>
		<!--- End of first parallax --->	
		</div>

		<div class="container-fluid white-background">
			<div class="row justify-content-center" style="padding-top: 3rem; padding-bottom: 3rem;">
				<div class="col-lg-4 "> </div>
				<div class="col-lg-4 black-font" style="text-align: center;">
					<p>The "Bailey Bee Team" was first created in 2014 as a way to introduce bees to the same living space as undergraduate students. Fast forward to the present and the same colonies, along with a few more at the Student Organic Farm are producing honey that is being sold under the Land Grant Goods name.</p>
					<p class="bold">Enter your honey's unique identifying number below!</p>
					
					<!--- QR input field and element --->
					<input type="text" class="qrcode-text" id="qrcode" placeholder="Enter Jar ID or Scan a QR Code!"
					><label class="qrcode-text-btn">
						<!--- This is the QR loading to open the camera then process the QR image (input then 'onchange'). In the JS code, there is also the additon of success and error handling, and prompting them with a message when the click the qr code to scan('onclick')--->
						<input
							type=file
						    accept="image/*"
						    capture=environment
						    onclick="return showQRIntro();"
						    onchange="openQRCamera(this);"
						    tabindex=-1>
					</label>

					<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample" onclick="OnLoadButtonClick()">
						Load
					</button>
				</div>
				<div class="col-lg-4 col-md-3"> </div>
			</div>

		<div class="row" id="reloadOnFetch" style="padding-bottom: 2rem;">
			<div class="col-lg-2 col-xl-2"></div>
			<div class="col-md-12 col-lg-8 col-xl-8">
				<!-- JarID Data Table Collapse handler, MAYBE MAKE IT A MODAL-->
				<div class="collapse" id="collapseExample">
					<div class="card card-body">
				  	<!-- JarID Data Table-->
				    	<div class="table-responsive">
							<table class="table table-bordered">
								<!--Main-->
								<thead class="thead-light">
								<tr>
									<th scope="col">Type</th>
									<th scope="col">Information</th>
								</tr>
								</thead>

								<tbody>
								<tr>
									<th scope="row">Jar ID:</th>
									<td id="jarIdId"></td>
								</tr>
								<tr>
									<th scope="row">Packager:</th>
									<td id="packagerId"></td>
								</tr>
								<tr>
									<th scope="row">Status:</th>
									<td id="statusId"></td>
								</tr>
								<tr>
									<th scope="row">Storage Location:</th>
									<td id="storageLocationId"></td>
								</tr>

								<!--Batch-->
								<thead class="thead-light">
								<tr>
									<th colspan="2" scope="col">Batch Transactions</th>
								</tr>
								</thead>

								<tr>
									<th scope="row">Date</th>
									<td id="dateTimeBatchId"></td>
								</tr>
								<tr>
									<th scope="row">Employee</th>
									<td id="employeeBatchId"></td>
								</tr>
								<tr>
									<th scope="row">Batch</th>
									<td id="batchBatchId"></td>
								</tr>
								<tr>
									<th scope="row">Transaction ID</th>
									<td id="transactionIdBatchId"></td>
								</tr>
								<tr>
									<th scope="row">Timestamp</th>
									<td id="timestampBatchId"></td>
								</tr>
								<tr>
									<th scope="row">Jar ID</th>
									<td id="jarIdBatchId"></td>
								</tr>
								<tr>
									<th scope="row">Status</th>
									<td id="statusBatchId"></td>
								</tr>
								<tr>
									<th scope="row">Storage Location</th>
									<td id="storageLocationBatchId"></td>
								</tr>

								<!--Jar-->
								<thead class="thead-light">
								<tr>
									<th colspan="2" scope="col">Jar Transactions</th>
								</tr>
								</thead>

								<tr>
									<th scope="row">Date</th>
									<td id="dateTimeJarId"></td>
								</tr>
								<tr>
									<th scope="row">Employee</th>
									<td id="employeeJarId"></td>
								</tr>
								<tr>
									<th scope="row">Jar</th>
									<td id="jarNumberJarId"></td>
								</tr>
								<tr>
									<th scope="row">Transaction ID</th>
									<td id="transactionIdJarId"></td>
								</tr>
								<tr>
									<th scope="row">Timestamp</th>
									<td id="timestampJarId"></td>
								</tr>
								<tr>
									<th scope="row">Status</th>
									<td id="statusJarId"></td>
								</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>

			</div>
			<div class="col-lg-2 col-xl-2"></div>
		</div>
	</div>

	<!-- Footer -->
	<footer class="page-footer custom-footer font-small blue pt-4">
	    
	    <!-- Footer Links -->
	    <div class="container-fluid text-center text-md-left">	      
	      <!-- Grid row -->
	      <div class="row justify-content-center">	        
	        <!-- Grid column -->
	        <div class="">
	          <!-- Content -->
	          <a href="https://spartanblockchain.org" style="color: white"><h5 class="">Powered By Spartan Blockchain</h5></a>
	        </div>
	        <!-- Grid column -->	        
	        <hr class="clearfix w-100 d-md-none pb-3">
	      </div>
	      <!-- Grid row -->
	    </div>
	    <!-- Footer Links -->

	    <!-- Copyright -->
	    <div class="footer-copyright text-center py-3 white-font">Â© 2019 Copyright:
	      <a href="https://www.landgrantgoods.com/"> Land Grant Goods </a>
	    </div>
	    <!-- Copyright -->

	</footer>
	 <!-- Footer -->

	 <!-- parralax -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	<script src="js/parallax.js"></script>

	<!-- bootstrap -->
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
	
	<!--- QR Code scanner using modified zxing scripts for QR processing. MUST TRANSFORM TO LOCAL, EMAIL ANGELO SAVICH IF NOT MADE LOCAL BY BEGINNING OF OCTOBER 2019 OR SITE FUNCTIONALITY won't be quite right.--->
	<script src="https://rawgit.com/sitepoint-editors/jsqrcode/master/src/qr_packed.js"></script>
	<!--- Script for QR Code --->
	<script type="text/javascript">
		function openQRCamera(node) {
		  var reader = new FileReader();
		  reader.onload = function() {
		    node.value = "";
		    qrcode.callback = function(res) {
		      if(res instanceof Error) {
		        alert("No QR code found. Please make sure the QR code is within the camera's frame and try again.");
		      } else {
		        node.parentNode.previousElementSibling.value = res;
		      }
		    };
		    qrcode.decode(reader.result);
		  };

		  //var qrResult = qrcode.decode(reader.result);
		  reader.readAsDataURL(node.files[0]);
		}
		// this tells the user what the purpose of the scanner is. It is used in the html above from the scanner input
		function showQRIntro() {
		  return confirm("Use your camera to take a picture of a QR code.");
		}

		function qrCodeTojQuery(){
			var qrCodeData = document.getElementById('qrcode').value;
		}
	</script>

	<!-- Script for populating customer product data -->
	<script>
			// These have the main variable values assigned to them. The JarIdId has Id twice to show its an html element id. Etc, applies to the rest
			const jarIdValueDisplay = document.getElementById('jarIdId');
			const packagerValueDisplay = document.getElementById('packagerId');
			const statusValueDisplay = document.getElementById('statusId');
			const storageLocationValueDisplay = document.getElementById('storageLocationId');
			const transactionsValueDisplay = document.getElementById('transactionsId');

			//These have the batch var values assigned to them
			const dateTimeBatchValueDisplay = document.getElementById('dateTimeBatchId');
			const employeeBatchValueDisplay = document.getElementById('employeeBatchId');
			const batchBatchValueDisplay = document.getElementById('batchBatchId');
			const transactionIdBatchValueDisplay = document.getElementById('transactionIdBatchId');
			const timestampBatchValueDisplay = document.getElementById('timestampBatchId');
			const jarIdBatchValueDisplay = document.getElementById('jarIdBatchId');
			const statusBatchValueDisplay = document.getElementById('statusBatchId');
			const storageLocationBatchValueDisplay = document.getElementById('storageLocationBatchId');

			//These have the jar batch var values assigned to them
			const dateTimeJarValueDisplay = document.getElementById('dateTimeJarId');
			const employeeJarValueDisplay = document.getElementById('employeeJarId');
			const jarJarValueDisplay = document.getElementById('jarNumberJarId');
			const transactionIdJarValueDisplay = document.getElementById('transactionIdJarId');
			const timestampJarValueDisplay = document.getElementById('timestampJarId');
			const statusJarValueDisplay = document.getElementById('statusJarId');

			//  returns none for empty info instead of a blank space or empty list
			function FixValue(object) {
				for (var value in object){
					if (object.hasOwnProperty(value)){
						return object;
					}
				}
				return "None"
			}

			function PullDataAfterHash(string){
				return string.split('#').pop()
			}

			 // This assigns the URL to get the files depending on the id.
			function JarIdFetcher(){
			//pulls JarId from field
			qrCodeData = document.getElementById('qrcode').value;
			if (qrCodeData){var URL = 'http://localhost:3000/api/honeyJar/'+qrCodeData;}
			else{var URL = null;}
			//var url = 'http://localhost:3000/api/org.sbs.supplychain.honeyJar/'+qrCodeData;
			
			// starts processing the id
				fetch(URL)
				.then((resp) => resp.json())
				.then(function(data) {
					let consumerData = data; // Pulls first dictionary from list, so uses top result.

					// Pulls all  Maindata for variables to be displayed from server
					var jarIdString = FixValue(consumerData.jarId);
					var packagerString = FixValue(consumerData.packager);
					var statusString = FixValue(consumerData.status);
					var storageLocationString = FixValue(consumerData.storageLocation);

					// Populates Batch Data from server
					var dateTimeBatchString = FixValue(consumerData.batchTransactions[0].dateTime);
					var employeeBatchString = PullDataAfterHash(FixValue(consumerData.batchTransactions[0].employee));  //pull out val from after hash
					var batchBatchString = PullDataAfterHash(FixValue(consumerData.batchTransactions[0].batch)); //pull out vall from after hash
					var transactionIdBatchString = FixValue(consumerData.batchTransactions[0].transactionID);
					var timestampBatchString = FixValue(consumerData.batchTransactions[0].timestamp);
					var jarIDBatchBatchString = FixValue(consumerData.batchTransactions[0].jarID);
					var statusBatchString = FixValue(consumerData.batchTransactions[0].status);
					var storageLocationBatchString = FixValue(consumerData.batchTransactions[0].storageLocation);

					// Populates Jar Data from server
					var dateTimeJarString = FixValue(consumerData.jarTransactions[0].dateTime);
					var employeeJarString = PullDataAfterHash(FixValue(consumerData.jarTransactions[0].employee)); //pull out name from after hash
					var jarJarString = PullDataAfterHash(FixValue(consumerData.jarTransactions[0].jar)); //pull out val from after hash
					var transactionIdJarString = FixValue(consumerData.jarTransactions[0].transaction);
					var timestampJarString  = FixValue(consumerData.jarTransactions[0].timestamp);
					var statusJarString  = FixValue(consumerData.jarTransactions[0].status);

					// Populates with Main data
					jarIdValueDisplay.innerHTML = `${jarIdString}`;
					packagerValueDisplay.innerHTML = `${packagerString}`;
					statusValueDisplay.innerHTML = `${statusString}`;
					storageLocationValueDisplay.innerHTML = `${storageLocationString}`;

					// Populates Batch Data
					dateTimeBatchValueDisplay.innerHTML = `${dateTimeBatchString}`;
					employeeBatchValueDisplay.innerHTML = `${employeeBatchString}`;
					batchBatchValueDisplay.innerHTML = `${batchBatchString}`;
					transactionIdBatchValueDisplay.innerHTML = `${transactionIdBatchString}`;
					timestampBatchValueDisplay.innerHTML = `${timestampBatchString}`;
					jarIdBatchValueDisplay.innerHTML = `${jarIDBatchBatchString}`;
					statusBatchValueDisplay.innerHTML = `${statusBatchString}`;
					storageLocationBatchValueDisplay.innerHTML = `${storageLocationBatchString}`;
					
					// Populates Jar Data
					dateTimeJarValueDisplay.innerHTML = `${dateTimeJarString}`;
					employeeJarValueDisplay.innerHTML = `${employeeJarString}`;
					jarJarValueDisplay.innerHTML = `${jarJarString}`;
					transactionIdJarValueDisplay.innerHTML = `${transactionIdJarString}`;
					timestampJarValueDisplay.innerHTML = `${timestampJarString}`;
					statusJarValueDisplay.innerHTML = `${statusJarString}`;

					})

					// This is required to reload and populate the element
				.catch(function(error) {
			    console.log(error)
				})}
			</script>
		<script>
				function OnLoadButtonClick(){
					JarIdFetcher();
				}

				//alert("This site is not fully developed. I will get it done once we have established backend formatting so I don't have to keep redoing the front end formatting.");
		</script>

	</body>
</html>
<!-- <h1 class="removefirstheaderspacing"></h1> -->



<!--Public Notes
#1: Put all scripts after loading page content so that page content loads  as quickly as possible.
#2: Keep style on top so shows up styled, not ugly then becomes styled.
#3: Function goes down because can have page load but not full function yet, feels faster.
#4: Conveying meaning to assistive technologies; using color to add meaning only provides a visual indication,
	which will not be conveyed to users of assistive technologies â such as screen readers.
	Ensure that information denoted by the color is either obvious from the content itself (e.g. the visible text),
	or is included through alternative means, such as additional text hidden with the .sr-only class.
#5
--> 